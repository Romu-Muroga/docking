<div class="wrapper">
  <div class="container-fluid">
    <div class="row">
      <div class="col-xs-3 col-md-3">
        <div class="category_list_in_users_show">
          <%= link_to posts_path, class: "logo" do %>
            <%= image_tag("/images/logo.png", class: "img-responsive") %>
          <% end %>
          <table class="table table-hover table_resize">
            <thead>
              <tr>
                <th>カテゴリー</th>
              </tr>
            </thead>
            <tbody>
              <% @categories.each do |category| %>
                <tr class="active_category">
                  <td><%= link_to category.name, category_user_path(category, @user) %></td>
                </tr>
              <% end %>
              <script type="text/javascript">
                 var url = window.location.pathname;
                    $('.active_category td a[href="'+url+'"]').addClass('active');
              </script>
            </tbody>
          </table>
        </div>
      </div>
      <div class="col-xs-6 col-md-6 centerbar">
        <% if @user_posts.present? %>
          <% @user_posts.each do |user_post| %>
            <div class="thumbnail">
              <p class="category_label"><%= user_post.category.name %></p>
              <h3 style="font-weight: bold;"><%= user_post.ranking_point %>&nbsp;&nbsp;&nbsp;<%= user_post.eatery_name %></h3>
              <h4>メニュー名&nbsp;&nbsp;&nbsp;<%= user_post.eatery_food %></h4>
              <% if user_post.picture.present? %>
                <%= image_tag(user_post.picture.image.url, class: "img-responsive") %>
              <% else %>
                <%= image_tag("/images/default2.jpg", class: "img-responsive")%>
              <% end %>
              <div class="caption">
                <p>お気に入りの理由は？</p>
                <div class="remarks">
                  <%= simple_format(user_post.remarks.truncate(150, omission: '...')) %>
                </div>
                <!-- TODO: リファクタリング -->
                <p>いいね！&nbsp;&nbsp;<%= user_post.likes_count %>回</p>
                <p>所在地：<%= user_post.eatery_address %></p>
                <!-- TODO: 存在しないアドレスだと404エラーになる -->
                <% if user_post.eatery_website == "未登録" %>
                  <p>ホームページ：未登録</p>
                <% else %>
                  <p>ホームページ：<%= link_to user_post.eatery_name, user_post.eatery_website %></p>
                <% end %>
                <p><%= link_to "詳細をみる", post_path(user_post), class: "btn btn-custum" %></p>
                <% if user_post.user_id != current_user.id %>
                  <li id="post-<%= user_post.id %>" data-post-id="<%= user_post.id %>" class="iine_button">
                    <%= render "likes/like", post: user_post %><!-- いいねボタン -->
                  </li>
                <% end %>
                <% if user_post.user_id == current_user.id %>
                  <p class="edit_delete_button">
                    <%= link_to "編集", edit_post_path(user_post), class: "btn btn-black" %>
                    <%= link_to "削除", post_path(user_post), method: :delete, data: { confirm: "削除してよろしいですか？" }, class: "btn btn-default" %>
                  </p>
                <% end %>
              </div>
            </div>
          <% end %>
        <% else %>
          <h4 class="no_content">投稿がありません</h4>
        <% end %>
      </div>
      <div class="col-xs-2 col-md-2 sidebar">
        <div class="user_info">
          <p><%= @user.name %></p>
          <% if @user.picture.present? %>
            <%= image_tag(@user.picture.image.url, class: "img-responsive") %>
          <% else %>
            <%= image_tag("/images/default.png", class: "img-responsive")%>
          <% end %>
          <% if @user.id == current_user.id %>
            <%= link_to "アカウント情報変更", edit_user_path(current_user) %><br>
            <%= link_to "退会処理", destroy_confirm_user_path(current_user) %>
            <%= link_to "新規投稿", new_post_path, class: "cp_btn" %>
            <%= link_to iine_post_list_user_path(@user), class: "iine_posts_link" do %>
              <%= content_tag :span, "いいね！済みのリスト", id: "heart", style: "padding-left: 20px;" %>
            <% end %>
            <p>フォロワーリストに変更予定</p>
            <div class="iine_box">
              <% if @user.iine_posts.present? %>
                <% @user.iine_posts.each do |iine_post| %>
                  <% if iine_post.user.picture.present? %>
                    <span><%= image_tag(iine_post.user.picture.image.url, size: "30x30") %></span>
                  <% else %>
                    <span><%= image_tag("/images/default.png", size: "30x30") %></span>
                  <% end %>
                  <span style="font-size: 12px"><%= iine_post.user.name %></span>
                  <span><%= link_to "#{iine_post.eatery_name}", post_path(iine_post) %></span><br>
                <% end %>
              <% else %>
                <p class="no_liked_posts_message">いいね！した<br>投稿がありません。</p>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
