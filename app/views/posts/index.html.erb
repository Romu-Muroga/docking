<div class="wrapper">
  <div class="container-fluid">
    <div class="row">
      <div class="col-xs-offset-1 col-xs-2 col-md-offset-1 col-md-2 leftsidebar">
        <div class="category_list">
          <%= link_to posts_path, class: "logo" do %>
            <%= image_tag("/images/logo.png", class: "img-responsive") %>
          <% end %>
          <table class="table table-hover">
            <thead>
              <tr>
                <th>カテゴリー</th>
              </tr>
            </thead>
            <tbody>
              <% @categories.each do |category| %>
                <tr class="active_category">
                  <td><%= link_to category.name, category_posts_path(category) %></td>
                </tr>
              <% end %>
              <script type="text/javascript">
                 var url = window.location.pathname;
                    $('.active_category td a[href="'+url+'"]').addClass('active');
              </script>
            </tbody>
          </table>
        </div>
      </div>
      <div class="col-xs-offset-3 col-xs-6 col-md-offset-3 col-md-6 centerbar">
        <!-- <p id="slideshow"> -->
          <%#= image_tag("/images/photo1.jpg", class: "img-responsive active") %>
          <%#= image_tag("/images/photo2.jpg", class: "img-responsive") %>
          <%#= image_tag("/images/photo3.jpg", class: "img-responsive") %>
          <%#= image_tag("/images/photo4.jpg", class: "img-responsive") %>
          <%#= image_tag("/images/photo5.png", class: "img-responsive") %>
          <%#= image_tag("/images/photo6.jpg", class: "img-responsive") %>
        <!-- </p> -->
        <ul id="slide_wrapp">
          <li class="slide_item"><%= image_tag("/images/photo1.jpg") %></li>
          <li class="slide_item"><%= image_tag("/images/photo2.jpg") %></li>
          <li class="slide_item"><%= image_tag("/images/photo3.jpg") %></li>
          <li class="slide_item"><%= image_tag("/images/photo4.jpg") %></li>
          <li class="slide_item"><%= image_tag("/images/photo5.png") %></li>
          <li class="slide_item"><%= image_tag("/images/photo6.jpg") %></li>
        </ul>
        <!-- <script type="text/javascript">
          function slideSwitch() {
             var $active = $('#slideshow img.active');
             if ( $active.length == 0 ) $active = $('#slideshow img:last');
             var $next =  $active.next().length ? $active.next()
                : $('#slideshow img:first');
             $active.addClass('last-active');
             $next.css({opacity: 0.0})
                .addClass('active')
                .animate({opacity: 1.0}, 1000, function() {
                     $active.removeClass('active last-active');
                });
          };
          $(function() {
             setInterval( "slideSwitch()", 3000 );
          });
        </script> -->
        <table border="2" width="690" class="ranking_table">
          <tr>
            <td><%= link_to "総合ランキング", posts_path(overall_sort: "true"), class: cp(posts_path(overall_sort: "true")) %></td>
            <td><%= link_to "いいねランキング", posts_path(iine_sort: "true"), class: cp(posts_path(iine_sort: "true")) %></td>
          </tr>
        </table>
        <% if @posts.class == Hash %>
          <h5 class="ranking_info">
            総合ランキングは、お客さま１人１人がマイページで登録したお気に入りのランキングをポイントによって集計し、<br>
            <br>
            １位＝３pt<br>
            ２位＝２pt<br>
            ３位＝１pt<br>
            <br>
            その合計に、いいね！のカウント数を加算して算出されています。<br>
            主観的な評価（ランキングのポイント） + 客観的な評価（いいね！のカウント数） = 総合ランキング<br>です。
          </h5>
          <% @posts.each_with_index do |(key, value), i| %>
            <h3 style="font-family: serif;"><%= i + 1 %>位 店名：<%= key[0] %> <%= value[:point] %>ポイント</h3>
          <% end %>
        <% elsif @posts.present? %>
          <% @posts.each do |post| %>
            <div class="thumbnail">
              <p class="category_label"><%= post.category.name %></p>
              <h3 style="font-weight: bold;"><%= post.ranking_point %>&nbsp;&nbsp;&nbsp;<%= post.eatery_name %></h3>
              <h4>Menu name: &nbsp;<%= post.eatery_food %></h4>
              <% if post.picture.present? %>
                <%= image_tag(post.picture.image.url, class: "img-responsive") %>
              <% else %>
                <%= image_tag("/images/default2.jpg", class: "img-responsive")%>
              <% end %>
              <div class="caption">
                <p>お気に入りの理由は？</p>
                <div class="remarks">
                  <%= simple_format(post.remarks.truncate(150, omission: '...')) %>
                </div>
                <p>Address: <%= post.eatery_address %></p>
                <!-- TODO: フォロー/フォロワー機能を実装したらフォロワーだけがユーザーのshowページを閲覧できるようにする -->
                <p>
                  <span>Contributor: <%= post.user.name %><%#= link_to post.user.name, user_path(post.user) %></span>&nbsp;&nbsp
                  <span style="color: silver">
                    <time datetime="<%= post.updated_at %>">
                      <%= time_ago_in_words(post.updated_at, include_seconds: true)+"前" %>
                    </time>
                  </span>
                </p>
                <p><%= link_to "詳細をみる", post_path(post), class: "btn btn-show" %></p>
                <div id="post-<%= post.id %>" data-post-id="<%= post.id %>" class="iine_button">
                  <%= render "likes/like", post: post %><!-- いいねボタン -->
                </div>
                <% if post.user_id == current_user.id %>
                  <p class="edit_delete_button">
                    <%= link_to 'EDIT', edit_post_path(post), class: "btn btn-default" %>
                    <%= link_to 'DELETE', post_path(post), method: :delete, data: { confirm: "削除してよろしいですか？" }, class: "btn btn-default" %>
                  </p>
                <% end %>
              </div>
            </div>
          <% end %>
        <% else %>
          <h4 class="no_content">投稿がありません</h4>
        <% end %>
      </div>
      <div class="col-xs-2 col-md-2 rightsidebar">
        <div class="new_post_and_search_menu">
          <%= link_to "新規投稿", new_post_path, class: "cp_btn" %>
          <%= form_with(model: Post.new, url: search_posts_path, method: :get, local: true, class: "search_form_outer") do |f| %>
            <div class="search_form_inner">
              <div class="form-group">
                <%= f.label :eatery_address %>
                <%= f.text_field :eatery_address, class: "form-control" %>
              </div>
              <div class="form-group">
                <%= f.label :eatery_name %>
                <%= f.text_field :eatery_name, class: "form-control" %>
              </div>
              <div class="form-group">
                <%= f.label :category_id %>
                <%= f.collection_select :category_id, Category.all, :id, :name, include_blank: true, selected: "", class: "form-control" %>
              </div>
              <div class="form-group">
                <%= f.label :ranking_point %>
                <!-- formはデフォルトで""がついてしまうため、.keysが必要 -->
                <%= f.select :ranking_point, Post.ranking_points.keys, include_blank: true, selected: "", class: "form-control" %>
              </div>
              <%= f.submit "検索", class: "btn btn-default" %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
  <div id="page_top"><a href="#"></a></div>
  <script type="text/javascript">
    $(function() {
        var pagetop = $('#page_top');
        pagetop.hide();
        $(window).scroll(function () {
            if ($(this).scrollTop() > 200) {  //200pxスクロールしたら表示
                pagetop.fadeIn();
            } else {
                pagetop.fadeOut();
            }
        });
        pagetop.click(function () {
            $('body,html').animate({
                scrollTop: 0
            }, 500); //0.5秒かけてトップへ移動
            return false;
        });
    });
  </script>
</div>
